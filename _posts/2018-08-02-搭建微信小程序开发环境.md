---
layout: post
title: "搭建微信小程序开发环境"
description: ""
categories: [MacOS, Linux]
tags: [MacOS, nginx, Linux, wechat, 微信, 服务器]
redirect_from:
  - /2018/08/02/
---

首先你得有一个自己的公网服务器，要是没事练手的话局域网的linux也行  

### 目录  

> * [I、安装Nginx](#one)  
> * [II、安装Nodejs](#two)  
> * [III、安装微信开发者工具](#three)  
> * [IV、添加SSL证书以支持HTTPS协议](#four)  


<a name="one"></a>  

### I、安装Nginx  

1.安装Nginx  

MacOS  

> brew install nginx  

怎么安装跟使用`brew`就不介绍了我们[官网](https://brew.sh/index_zh-cn)见

CentOS/RedHat  

> sudo yum install epel-release  
> sudo yum install nginx

debian/ubuntu/deepin

>  sudo apt-get install nginx

2.开机自启，若不嫌麻烦可以省略这一个步骤  

CentOS/RedHat/Fedora  

> systemctl enable nginx  

debian/ubuntu/deepin  

> sudo vim /etc/rc.local  

文件，在exit 0语句前加入： /etc/init.d/nginx start

3.获取SSL证书

使用openssl命令创建服务器私钥，输入相应命令  

> $ openssl genrsa -des3 -out server.key 1024   

创建证书,命令,后面会提示输入相应证书信息，按照要求输入即可,好像也可以不输入  

> openssl req -new -key server.key -out server.csr  

清除以SSL启动Nginx时提示必须输入密钥  

> cp server.key server.key.org  
> openssl rsa -in server.key.org -out server.key  

使用刚生成的私钥和CSR进行证书签名  

> openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt  


4.配置nginx

~~~  
upstream app_weapp {
    server localhost:5757;
    keepalive 8;
}

server {
    listen      80;
    server_name wx.ijason.cc; # 把这个改成你自己的域名，如果是本地局域网的话改成'localWeChat.com'后文解释

    rewrite ^(.*)$ https://$server_name$1 permanent;
}

server {
    listen      443;
    server_name wx.ijason.cc; # 改成上面一样的域名

    ssl on;

    ssl_certificate           /data/release/nginx/1_wx.ijason.cc_bundle.crt; # 修改成你刚刚生成的地址server.crt文件路径
    ssl_certificate_key       /data/release/nginx/2_wx.ijason.cc.key; # 修改成你刚刚生成的地址server.key文件路径
    ssl_session_timeout       5m;
    ssl_protocols             TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers               ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA;
    ssl_session_cache         shared:SSL:50m;
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass http://app_weapp;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
~~~   

4.添加本地域名解析  

> $ vim /etc/hosts  
~~~
# 加入下面这句
127.0.0.1   localWeChat.com
~~~

4.修改/关闭防火墙  

> // 简单粗暴的关掉防火墙  

CentOS/RedHat/Fedora  

> service firewalld stop  

debian/ubuntu/deepin  

> service iptalbs stop  

> // 配置防火墙  

CentOS/RedHat/Fedora  

> firewall-cmd --permanent --zone=public --add-service=httpd  
> service firewall restart  

debian/ubuntu/deepin  

> vim /etc/sysconfig/iptables  

写入  
~~~  
-A INPUT -m state –state NEW -m tcp -p tcp –dport 3306 -j ACCEPT
~~~  

> service iptables restart  

5.关闭Selinux  
这玩意只有Redhat系列上有  

> vim /etc/selinux/config  
~~~
SELINUX=disabled
~~~

再去浏览器试一下打开 http://localWeChat.com  

<a name="two"></a>  

### II、安装node js  

1.下载源码包  
> wget http://cdn.npm.taobao.org/dist/node/v10.7.0/node-v10.7.0.tar.gz  

2.解压  
> tar xvf node-v10.7.0.tar.gz  

3.编译  
> cd node-v10.7.0  
> make  

4.安装  
make install  

在`CentOS`上貌似需要[升级GCC](https://xuzheyang.github.io/blog/2017/10/02/Linux学习之CentOS利用devtools-set安装高版本gcc/)

